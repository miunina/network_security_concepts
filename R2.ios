conf terminal
license boot module c1900 technology-package securityk9

enable
configure terminal
int ser0/1/0
ip address 172.30.2.2 255.255.255.0
no sh
int fa0/0
ip address 192.168.1.1 255.255.255.0
no sh
end
#------------------------------ACL
conf t
ip access-list extend siteB_in
permit ip 192.168.1.0 0.0.0.255 192.168.3.0 0.0.0.255
permit icmp host 10.1.1.2 host 10.2.2.2 
permit udp host 10.1.1.2 host 10.2.2.2
permit udp host 10.1.1.2 host 10.2.2.2 eq isakmp
permit esp host 10.1.1.2 host 10.2.2.2
permit ah host 10.1.1.2 host 10.2.2.2
deny ip any any
exit
int ser0/1/0
ip access-group siteB_in in
ip access-list extend siteB_out
permit ip 192.168.3.0 0.0.0.255 192.168.1.0 0.0.0.255
permit icmp host 10.2.2.2 host 10.2.2.1
permit udp host 10.2.2.2 host 10.2.2.1
permit udp host 10.2.2.2 host 10.2.2.1 eq isakmp
permit esp host 10.2.2.2 host 10.2.2.1
permit ah host 10.2.2.2 host 10.2.2.1
deny ip any any
exit 
int ser0/1/0
ip access-group siteB_out out
#---------------IKE Ph1 isakmp policy
crypto isakmp policy 10
encryption aes 256
authentication pre-share 
group 5
exit
conf t
crypto isakmp key vpnpa55 address 10.1.1.2

crypto ipsec transform-set VPN_SET esp-aes  esp-sha-hmac 
exit
conf t
access-list 110 permit ip 192.168.3.0 0.0.0.255 192.168.1.0 0.0.0.255

conf terminal
crypto map VPN_MAP 10 ipsec-isakmp
description VPN connection to R1
set peer 10.1.1.2
set transform-set VPN_SET
match address 110
exit

conf terminal
interface serial0/0/1
crypto map VPN_MAP