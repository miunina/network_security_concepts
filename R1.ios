conf terminal
license boot module c1900 technology-package securityk9
enable
configure terminal
int ser0/1/0
ip address 172.30.2.1 255.255.255.0
no sh
int fa0/0
ip address 10.0.1.1 255.255.255.0
no sh
end
#------------------------------ACL
conf t
ip access-list extend siteA_in
permit ip 10.0.1.0 0.0.0.255 192.168.1.0 0.0.0.255
permit icmp host 172.30.2.1 host 172.30.2.2 
permit udp host 172.30.2.1 host 172.30.2.2
permit udp host 172.30.2.1 host 172.30.2.2 eq isakmp
permit esp host 172.30.2.1 host 172.30.2.2
permit ah host 172.30.2.1 host 172.30.2.2
deny ip any any
exit 
int ser0/1/0
ip access-group siteA_in in


ip access-list extended siteA_out
permit ip 192.168.1.0 0.0.0.255 10.0.1.0 0.0.0.255
permit icmp host 172.30.2.2 host 172.30.2.1
permit udp host 172.30.2.2 host 172.30.2.1
permit udp host 172.30.2.2 host 172.30.2.1 eq isakmp
permit esp host 172.30.2.2 host 172.30.2.1
permit ah host 172.30.2.2 host 172.30.2.1
deny ip any any
exit 
int ser0/1/0
ip access-group siteA_out out

#----------------------isakmp

crypto isakmp key cisco12345 address 172.30.2.1
crypto isakmp policy 1
encryption aes 256
hash sha 
authentication pre-share 
group 5
lifetime 3600


#configure each router with an ACL to permit
# traffic from the local LAN to the remote LAN,
# as shown in the following examples for R1 and R2.
# The ACL will be used in the crypto map configuration 
#to specify what traffic will trigger the start of IKE Phase 1

access-list 101 permit ip 10.0.1.0 0.0.0.255 192.168.1.0 0.0.0.255

crypto ipsec transform-set ?
crypto ipsec transform-set R1-R2 ?

crypto ipsec transform-set R1-R2 esp-aes esp-sha-hmac 

#Crypto map
conf t
crypto map R1-R2_MAP 10 ipsec-isakmp

match address 101 
set transform-set R1-R2
set peer 172.30.2.2
set pfs group24
set security-association lifetime seconds 900 
exit

conf t
se0/1/0
crypto map R1-R2_MAP